{"version":3,"file":"ildcp-host.js","sourceRoot":"","sources":["ildcp-host.ts"],"names":[],"mappings":";;AAAA,mDAA2C;AAC3C,uCAAsD;AACtD,4CAA4C;AAC5C,MAAM,GAAG,GAAG,YAAY,CAAC,YAAY,CAAC,CAAA;AAGtC;IAGE,YAAa,IAAqB;QAChC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,kBAAQ,CAAC,CAAA;IAChC,CAAC;IAED,KAAK,CAAC,MAAM,CAAE,IAAY,EAAE,aAAqB;QAC/C,MAAM,aAAa,GAAG,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,aAAa,CAAC,CAAA;QAClE,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,aAAa,CAAC,CAAA;QACjD,GAAG,CAAC,KAAK,CAAC,sDAAsD,EAAE,aAAa,CAAC,CAAA;QAEhF,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC;YACjB,aAAa,EAAE,IAAI;YACnB,OAAO,EAAE,GAAG,EAAE,CAAC,CAAC;gBACd,aAAa;gBACb,UAAU,EAAE,IAAI,CAAC,UAAU;gBAC3B,SAAS,EAAE,IAAI,CAAC,SAAS;aAC1B,CAAC;YACF,aAAa,EAAE,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE;SAC7C,CAAC,CAAA;IACJ,CAAC;CACF;AAtBD,sCAsBC","sourcesContent":["import Accounts from '../services/accounts'\nimport { create as createLogger } from '../common/log'\nimport ILDCP = require('ilp-protocol-ildcp')\nconst log = createLogger('ildcp-host')\nimport reduct = require('reduct')\n\nexport default class IldcpHostController {\n  protected accounts: Accounts\n\n  constructor (deps: reduct.Injector) {\n    this.accounts = deps(Accounts)\n  }\n\n  async handle (data: Buffer, sourceAccount: string) {\n    const clientAddress = this.accounts.getChildAddress(sourceAccount)\n    const info = this.accounts.getInfo(sourceAccount)\n    log.debug('responding to ILDCP config request. clientAddress=%s', clientAddress)\n\n    return ILDCP.serve({\n      requestPacket: data,\n      handler: () => ({\n        clientAddress,\n        assetScale: info.assetScale,\n        assetCode: info.assetCode\n      }),\n      serverAddress: this.accounts.getOwnAddress()\n    })\n  }\n}\n"]}